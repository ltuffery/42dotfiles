# ##############################################################################
# ##                   __ _          __ _     _                                #
# ##                  / _(_)        / _(_)   | |                               #
# ##   ___ ___  _ __ | |_ _  __ _  | |_ _ ___| |__                             #
# ##  / __/ _ \| '_ \|  _| |/ _` | |  _| / __| '_ \                            #
# ## | (_| (_) | | | | | | | (_| |_| | | \__ \ | | |                           #
# ##  \___\___/|_| |_|_| |_|\__, (_)_| |_|___/_| |_|                           #
# ##                         __/ |                                             #
# ##                        |___/                                              #
# ##                                                                           #
# ##############################################################################

fish_add_path "$HOME/bin";
fish_add_path "$HOME/.local/bin";
fish_add_path "$HOME/.local/share/42dotfiles/bin";

source "$HOME/.config/fish/profile.fish";

if status is-interactive;

	{{ if .show_motd_once -}}
	{{- if .tmux_autostart -}}
	if type -q tmux;
		tmux has-session -t=42DF > /dev/null 2>&1;
		if not test $status -eq 0;
			set -e DF42_MOTDSHOWN;
		else if not set -q DF42_MOTDSHOWN;
            set -U DF42_MOTDSHOWN;
            set motd "$HOME/.config/fish/motd";
            if test -x $motd;
                $motd;
            end
        end
	end
	{{- else -}}
	if not set -q DF42_MOTDSHOWN;
		set -x DF42_MOTDSHOWN;
		set motd "$HOME/.config/fish/motd";
		if test -x $motd;
			$motd;
		end
	end
	{{- end -}}
	{{- else -}}
	set motd "$HOME/.config/fish/motd";
	if test -x $motd;
		$motd;
	end
	{{- end }}

	{{ if .tmux_autostart -}}
    if set -q TMUX;
        set -f lastfetch "$HOME/.cache/42dotfiles/lastfetch";
		set -f today (date +%Y%m%d);
		if not test -f $lastfetch; or test $today -gt (cat $lastfetch);
			set_color brblue; 42df fetch;
		end
        mkdir -p (path dirname $lastfetch);
		echo $today > $lastfetch;
    end

    if not set -q TMUX; and type -q tmux;
        tmux has-session -t=42DF > /dev/null 2>&1;
        if test $status -eq 0;
			tmux new-window -t=42DF;
            exec tmux attach -t=42DF;
        else
            exec tmux new-session -s 42DF;
        end
    end
	{{- else -}}
	set -f lastfetch "$HOME/.cache/42dotfiles/lastfetch";
	set -f today (date +%Y%m%d);
	if not test -f $lastfetch; or test $today -gt (cat $lastfetch);
		set_color brblue; 42df fetch;
	end
	mkdir -p (path dirname $lastfetch);
	echo $today > $lastfetch;
	{{- end }}
    
	bind \cp "fzfvim";
	bind \cd "fzfcd";

    zoxide init fish | source;
    starship init fish | source;
end
